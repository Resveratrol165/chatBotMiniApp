{"version":3,"file":"audioView.js","sources":["pages/audioView.vue","../../../Tools/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvYXVkaW9WaWV3LnZ1ZQ"],"sourcesContent":["<template>\r\n  <view class=\"audio-container\">\r\n    <view class=\"audio-button-container\">\r\n      <!-- 动态圆圈容器 -->\r\n      <view class=\"circle-container\" :class=\"{ 'circle-active': isRecording }\">\r\n        <view class=\"dynamic-circle\" :style=\"{\r\n          transform: `scale(${circleScale})`,\r\n          borderWidth: `${circleBorderWidth}rpx`\r\n        }\"></view>\r\n      </view>\r\n      \r\n      <!-- Windows 11 风格加载动画 -->\r\n      <view class=\"loading-container\" :class=\"{ 'loading-active': isPending }\">\r\n        <view class=\"loading-circle\"></view>\r\n      </view>\r\n      \r\n      <!-- 主按钮 -->\r\n      <view class=\"audio-button\"\r\n            :class=\"{\r\n              'recording': isRecording,\r\n              'pending': isPending\r\n            }\"\r\n            @touchstart=\"startRecording\"\r\n            @touchend=\"stopRecording\"\r\n            @touchcancel=\"cancelRecording\">\r\n        <text class=\"button-text\">{{ buttonText }}</text>\r\n      </view>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, computed } from 'vue';\r\n\r\nconst isRecording = ref(false);\r\nconst isPending = ref(false);\r\nconst recorderManager = uni.getRecorderManager();\r\nconst innerAudioContext = uni.createInnerAudioContext();\r\nconst circleScale = ref(1);\r\nconst circleBorderWidth = ref(4);\r\n\r\n// 按钮文字\r\nconst buttonText = computed(() => {\r\n  if (isRecording.value) return '松开发送';\r\n  if (isPending.value) return '处理中...';\r\n  return '按住说话';\r\n});\r\n\r\n// 开始录音\r\nconst startRecording = () => {\r\n  if (innerAudioContext.paused === false) {\r\n    innerAudioContext.stop();\r\n  }\r\n  \r\n  isPending.value = false;\r\n  isRecording.value = true;\r\n  circleScale.value = 1;\r\n  circleBorderWidth.value = 4;\r\n  \r\n  recorderManager.start({\r\n    duration: 60000,\r\n    sampleRate: 16000,\r\n    numberOfChannels: 1,\r\n    encodeBitRate: 96000,\r\n    format: 'mp3',\r\n  });\r\n  \r\n  startVolumeAnimation();\r\n};\r\n\r\n// 停止录音\r\nconst stopRecording = () => {\r\n  if (!isRecording.value) return;\r\n  \r\n  isRecording.value = false;\r\n  isPending.value = true;\r\n  recorderManager.stop();\r\n  stopVolumeAnimation();\r\n};\r\n\r\n// 取消录音\r\nconst cancelRecording = () => {\r\n  isRecording.value = false;\r\n  isPending.value = false;\r\n  recorderManager.stop();\r\n  stopVolumeAnimation();\r\n};\r\n\r\nlet volumeTimer = null;\r\n\r\n// 音量动画\r\nconst startVolumeAnimation = () => {\r\n  // 监听音量变化\r\n  recorderManager.onFrameRecorded((res) => {\r\n    // 模拟音量值，实际应该使用res中的音量数据\r\n    const volume = Math.random(); // 0-1之间的值\r\n    \r\n    // 根据音量调整圆圈大小和边框宽度\r\n    circleScale.value = 1 + volume * 0.5; // 1-1.5倍大小变化\r\n    circleBorderWidth.value = 4 + volume * 16; // 4-20rpx边框宽度变化\r\n  });\r\n};\r\n\r\nconst stopVolumeAnimation = () => {\r\n  circleScale.value = 1;\r\n  circleBorderWidth.value = 4;\r\n};\r\n\r\n// 录音完成事件处理\r\nrecorderManager.onStop(async (res) => {\r\n  if (!isPending.value) return; // 如果不是在pending状态，说明是取消录音\r\n  \r\n  try {\r\n    // 模拟网络请求延迟\r\n    await new Promise(resolve => setTimeout(resolve, 3000));\r\n    \r\n    // 这里添加发送录音文件到服务器的逻辑\r\n    // const response = await sendAudioToServer(res.tempFilePath);\r\n    // 播放返回的音频\r\n    // innerAudioContext.src = response.audioUrl;\r\n    // innerAudioContext.play();\r\n    \r\n    // TODO: 替换为实际的API调用\r\n    console.log('录音文件路径：', res.tempFilePath);\r\n    \r\n    // 重置状态\r\n    isPending.value = false;\r\n  } catch (error) {\r\n    console.error('处理录音失败：', error);\r\n    uni.showToast({\r\n      title: '处理失败，请重试',\r\n      icon: 'none'\r\n    });\r\n    isPending.value = false;\r\n  }\r\n});\r\n\r\n// 错误处理\r\nrecorderManager.onError((error) => {\r\n  console.error('录音错误：', error);\r\n  uni.showToast({\r\n    title: '录音出错，请重试',\r\n    icon: 'none'\r\n  });\r\n\r\n  // 检查是否是权限被拒绝\r\n  if (error.errMsg.includes('auth deny')) {\r\n    uni.showModal({\r\n      title: '权限问题',\r\n      content: '录音权限被拒绝，请前往设置中开启录音权限',\r\n      showCancel: false,\r\n      confirmText: '去设置',\r\n      success: (res) => {\r\n        if (res.confirm) {\r\n          // 引导用户进入设置页面\r\n          uni.openSetting({\r\n            success: (settingdata) => {\r\n              console.log('用户已进入设置页面，当前权限设置：', settingdata.authSetting);\r\n              if (settingdata.authSetting['scope.record']) {\r\n                console.log('录音权限已开启');\r\n              } else {\r\n                console.log('录音权限仍未开启');\r\n              }\r\n            }\r\n          });\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  // 重置状态\r\n  isRecording.value = false;\r\n  isPending.value = false;\r\n  stopVolumeAnimation();\r\n});\r\n</script>\r\n\r\n<style scoped>\r\n.audio-container {\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n  height: 100vh;\r\n  background-color: #FAFAFA;\r\n}\r\n\r\n.audio-button-container {\r\n  position: fixed;\r\n  left: 50%;\r\n  top: 50%;\r\n  transform: translate(-50%, -50%);\r\n  width: 600rpx;\r\n  height: 600rpx;\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n}\r\n\r\n.audio-button {\r\n  position: absolute;\r\n  left: 50%;\r\n  top: 50%;\r\n  transform: translate(-50%, -50%);\r\n  width: 280rpx;\r\n  height: 280rpx;\r\n  border-radius: 140rpx;\r\n  background: #007AFF;\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n  box-shadow: 0 8rpx 24rpx rgba(0, 122, 255, 0.2);\r\n  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\r\n  z-index: 2;\r\n}\r\n\r\n.audio-button.recording {\r\n  transform: translate(-50%, -50%) scale(0.95);\r\n  background: #0066CC;\r\n  box-shadow: 0 4rpx 12rpx rgba(0, 122, 255, 0.3);\r\n}\r\n\r\n.audio-button.pending {\r\n  animation: none;\r\n  transform: translate(-50%, -50%) scale(0.95);\r\n  background: #0066CC;\r\n  box-shadow: 0 4rpx 12rpx rgba(0, 122, 255, 0.3);\r\n}\r\n\r\n.button-text {\r\n  color: #ffffff;\r\n  font-size: 36rpx;\r\n  font-weight: 500;\r\n  letter-spacing: 1rpx;\r\n}\r\n\r\n.circle-container {\r\n  position: absolute;\r\n  top: 50%;\r\n  left: 50%;\r\n  transform: translate(-50%, -50%);\r\n  width: 280rpx;\r\n  height: 280rpx;\r\n  opacity: 0;\r\n  transition: opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1);\r\n}\r\n\r\n.circle-container.circle-active {\r\n  opacity: 1;\r\n}\r\n\r\n.dynamic-circle {\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n  width: 100%;\r\n  height: 100%;\r\n  border-radius: 50%;\r\n  border: 4rpx solid rgba(0, 122, 255, 0.3);\r\n  transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);\r\n  box-sizing: border-box;\r\n}\r\n\r\n.loading-container {\r\n  position: absolute;\r\n  top: 50%;\r\n  left: 50%;\r\n  transform: translate(-50%, -50%);\r\n  width: 380rpx; /* 比按钮大约135% */\r\n  height: 380rpx;\r\n  opacity: 0;\r\n  pointer-events: none;\r\n  transition: opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1);\r\n}\r\n\r\n.loading-container.loading-active {\r\n  opacity: 1;\r\n}\r\n\r\n.loading-circle {\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n  width: 100%;\r\n  height: 100%;\r\n  border-radius: 50%;\r\n  border: 12rpx solid transparent;\r\n  border-top-color: #007AFF;\r\n  border-right-color: #007AFF;\r\n  border-bottom-color: #007AFF;\r\n  animation: win11-spin 1s cubic-bezier(0.4, 0, 0.2, 1) infinite;\r\n  box-sizing: border-box;\r\n}\r\n\r\n@keyframes win11-spin {\r\n  0% {\r\n    transform: rotate(0deg);\r\n  }\r\n  100% {\r\n    transform: rotate(360deg);\r\n  }\r\n}\r\n</style> ","import MiniProgramPage from 'E:/Workspace/miniapp/chatBotMiniApp/pages/audioView.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","uni","computed"],"mappings":"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"}