{"version":3,"names":["ChatMessage","InputField","scrollTop","common_vendor","ref","messageContainer","loading","page","hasMore","chatData","userName","botName","userAvatar","botAvatar","chat","scrollToBottom","index","__f__","nextTick$1","query","createSelectorQuery","in","_this","select","fields","size","scrollOffset","dataset","data","value","exec","handleSendMessage","message","push","char","content","type","handleImageSelected","imagePath","watch","deep","initMessages","_ref","_asyncToGenerator2","_regeneratorRuntime2","mark","_callee","response","wrap","_callee$","_context","prev","next","length","error","stop","apply","arguments","loadMoreMessages","_ref2","_callee2","_chatData$value$chat","moreMessages","_callee2$","_context2","abrupt","Promise","resolve","setTimeout","unshift","t0","finish","handleScroll","onMounted","_a","addEventListener","onBeforeUnmount","removeEventListener","wx","createComponent","Component"],"sources":["chatView.vue","RTovV29ya3NwYWNlL21pbmlhcHAvY2hhdEJvdE1pbmlBcHAvcGFnZXMvY2hhdFZpZXcudnVl"],"sourcesContent":["<template>\r\n  <div class=\"chat-container\">\r\n    <!-- 聊天记录容器 -->\r\n    <scroll-view \r\n      class=\"messages-wrapper chat-scroll-view\" \r\n      scroll-y \r\n      :scroll-top=\"scrollTop\" \r\n    >\r\n      <!-- 加载更多提示 -->\r\n      <div v-if=\"loading\" class=\"loading-more\">\r\n        加载中...\r\n      </div>\r\n      \r\n      <!-- 聊天记录列表 -->\r\n      <div class=\"messages-list\">\r\n        <chat-message\r\n          v-for=\"(message, index) in chatData.chat\"\r\n          :key=\"index\"\r\n          :message=\"message\"\r\n          :user-avatar=\"chatData.userAvatar\"\r\n          :bot-avatar=\"chatData.botAvatar\"\r\n          :user-name=\"chatData.userName\"\r\n          :bot-name=\"chatData.botName\"\r\n        />\r\n      </div>\r\n    </scroll-view>\r\n    \r\n    <!-- 输入框组件 -->\r\n    <input-field\r\n      @send=\"handleSendMessage\"\r\n      @image-selected=\"handleImageSelected\"\r\n    />\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, onMounted, onBeforeUnmount, nextTick, watch } from 'vue'\r\nimport ChatMessage from '@/components/ChatMessage.vue'\r\nimport InputField from '@/components/InputField.vue'\r\n\r\nconst scrollTop = ref(0)\r\nconst messageContainer = ref(null)\r\nconst loading = ref(false)\r\nconst page = ref(1)\r\nconst hasMore = ref(true)\r\n\r\nconst chatData = ref({\r\n  userName: '',\r\n  botName: '',\r\n  userAvatar: '',\r\n  botAvatar: '',\r\n  chat: []\r\n})\r\n\r\n// 滚动到底部\r\nconst scrollToBottom = () => {\r\n  console.log(\"breakpoint0\")\r\n  nextTick(() => {\r\n    console.log(\"breakpoint1\")\r\n    const query = uni.createSelectorQuery().in(this)\r\n    query\r\n      .select('scroll-view')\r\n      .fields({\r\n        size: true,\r\n        scrollOffset: true,\r\n        dataset: true\r\n      }, data => {\r\n        console.log(\"container data:\", data)\r\n        if (data) {\r\n          console.log(\"breakpoint2\")\r\n          scrollTop.value = 99999\r\n        }\r\n      })\r\n      .exec()\r\n  })\r\n}\r\n\r\n// 处理发送消息\r\nconst handleSendMessage = (message) => {\r\n  chatData.value.chat.push({\r\n    char: \"USER\",\r\n    content: {\r\n      type: \"Text\",\r\n      message: message\r\n    }\r\n  })\r\n  console.log(chatData.value.chat)\r\n  scrollToBottom()\r\n}\r\n\r\n// 处理图片选择\r\nconst handleImageSelected = (imagePath) => {\r\n  chatData.value.chat.push({\r\n    char: \"USER\",\r\n    content: {\r\n      type: \"Image\",\r\n      message: imagePath\r\n    }\r\n  })\r\n  scrollToBottom()\r\n}\r\n\r\n// 监听消息列表变化\r\nwatch(\r\n  () => chatData.value.chat,\r\n  () => {\r\n    scrollToBottom()\r\n  },\r\n  { deep: true }\r\n)\r\n\r\n// 初始化消息列表\r\nconst initMessages = async () => {\r\n  try {\r\n    // 模拟从服务器获取数据\r\n    const response = {\r\n      userName: \"用户\",\r\n      botName: \"AI助手\",\r\n      userAvatar: \"/static/user-avatar.png\",\r\n      botAvatar: \"/static/bot-avatar.png\",\r\n      chat: [\r\n        {\r\n          char: \"USER\", \r\n          content: {\r\n            type: \"Text\",\r\n            message: \"你好\"\r\n          }\r\n        },\r\n        {\r\n          char: \"BOT\", \r\n          content: {\r\n            type: \"Text\",\r\n            message: \"你好！很高兴为你服务。我可以帮你处理文字、图片和音频消息。\"\r\n          }\r\n        },\r\n        {\r\n          char: \"USER\", \r\n          content: {\r\n            type: \"Image\",\r\n            message: \"https://img.picui.cn/free/2025/02/04/67a19ace30f9b.jpg\"\r\n          }\r\n        },\r\n        {\r\n          char: \"BOT\", \r\n          content: {\r\n            type: \"Text\",\r\n            message: \"我看到你发送了一张图片。图片处理功能正常工作中。\"\r\n          }\r\n        },\r\n        {\r\n          char: \"USER\", \r\n          content: {\r\n            type: \"Audio\",\r\n            message: \"audio_file_url\",\r\n            length: 15\r\n          }\r\n        },\r\n        {\r\n          char: \"BOT\", \r\n          content: {\r\n            type: \"Text\",\r\n            message: \"收到你的语音消息，时长15秒。\"\r\n          }\r\n        }\r\n      ]\r\n    }\r\n    chatData.value = response\r\n    scrollToBottom()\r\n  } catch (error) {\r\n    console.error('Failed to load messages:', error)\r\n  }\r\n}\r\n\r\n// 加载更多历史消息\r\nconst loadMoreMessages = async () => {\r\n  if (loading.value || !hasMore.value) return\r\n  \r\n  loading.value = true\r\n  try {\r\n    // TODO: 实现加载更多消息的逻辑\r\n    await new Promise(resolve => setTimeout(resolve, 1000))\r\n    // 模拟加载更多消息\r\n    const moreMessages = [\r\n      // ... 更多消息\r\n    ]\r\n    chatData.value.chat.unshift(...moreMessages)\r\n    page.value++\r\n  } catch (error) {\r\n    console.error('Failed to load more messages:', error)\r\n  } finally {\r\n    loading.value = false\r\n  }\r\n}\r\n\r\n// 监听滚动事件\r\nconst handleScroll = () => {\r\n  if (messageContainer.value && messageContainer.value.scrollTop <= 50) {\r\n    loadMoreMessages()\r\n  }\r\n}\r\n\r\nonMounted(() => {\r\n  initMessages()\r\n  messageContainer.value?.addEventListener('scroll', handleScroll)\r\n})\r\n\r\nonBeforeUnmount(() => {\r\n  messageContainer.value?.removeEventListener('scroll', handleScroll)\r\n})\r\n</script>\r\n\r\n<style scoped>\r\n.chat-container {\r\n  height: 100vh;\r\n  display: flex;\r\n  flex-direction: column;\r\n  background-color: #f5f5f5;\r\n  position: relative;\r\n}\r\n\r\n.messages-wrapper {\r\n  flex: 1;\r\n  height: calc(100vh - 60px - env(safe-area-inset-bottom));\r\n  padding: 20px;\r\n  background-color: #f5f5f5;\r\n}\r\n\r\n.loading-more {\r\n  text-align: center;\r\n  padding: 10px 0;\r\n  color: #999;\r\n  font-size: 14px;\r\n}\r\n\r\n.messages-list {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 16px;\r\n  padding-bottom: 20px;\r\n}\r\n</style>\r\n","import Component from 'E:/Workspace/miniapp/chatBotMiniApp/pages/chatView.vue'\nwx.createComponent(Component)"],"mappings":"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","ignoreList":[]}